# postgres:17 ì´ë¯¸ì§€ ê¸°ë°˜
# Description : Dockerfile.db - ğŸ“Œ db docker build
# Author : Shiwoo Min
# Date : 2025-09-06

# ì»¤ìŠ¤í…€ Postgres ì´ë¯¸ì§€
FROM postgres:17

# íƒ€ì„ì¡´ ì„¤ì •
ENV TZ=Asia/Seoul

# ìµœì†Œ ì„¤ì •: ì•„ë¬´ ì„¤ì •ë„ ê±´ë“œë¦¬ì§€ ì•Šê³  ì˜¤ì§ initë§Œ ë³µì‚¬
COPY infra/database/init/ /docker-entrypoint-initdb.d/

# # ë¡œê·¸ ë””ë ‰í† ë¦¬ ë¯¸ë¦¬ ìƒì„± (ì•ˆ ë§Œë“¤ë©´ ì„œë²„ ì‹¤í–‰ ì‹¤íŒ¨ ê°€ëŠ¥ì„± ìˆìŒ)
# RUN mkdir -p /var/lib/postgresql/data/pg_log && \
#     chown -R postgres:postgres /var/lib/postgresql/data/pg_log

# # ì„¤ì • íŒŒì¼ ë³µì‚¬ (ì´ë¯¸ì§€ ë‚´ ìœ„ì¹˜ë¡œ)
# COPY infra/database/conf/pg_hba.conf /etc/postgresql/pg_hba.conf
# COPY infra/database/conf/postgresql.conf /etc/postgresql/postgresql.conf

# # DB ì´ˆê¸°í™” SQL ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬ (PostgreSQLì˜ init hookì— ìë™ ì‹¤í–‰ë¨)
# COPY infra/database/init/ /docker-entrypoint-initdb.d/

# # ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶œë ¥ (ì„ íƒ)
# RUN echo "Custom DB image built with:" && \
#     ls -l /etc/postgresql && \
#     ls -l /docker-entrypoint-initdb.d || true
